<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Stroy</title>
	<script src="./vue.js"></script>
	<script src="./jquery.min.js"></script>
	<script src="./script.js"></script>
	<link rel="stylesheet" href="./style.css">
</head>
<body>
<div id="app">
	<table class="work-table">
		<tr>
			<th style="text-align:left;">Название</th>
			<th>Цена</th>
			<th><span class="desctop-title">Количество</span> <span class="mobile-title">Кол-во</span></th>
			<th style="text-align:left;">Тип</th>
		</tr>
		<tbody>
			<tr>
				<td colspan="4" class="table-title">
					Плиточные работы
				</td>
			</tr>
		</tbody>
		<tr v-for="service in services">
			<td class="title">{{ service.title }}</td>
			<td class="defaul-price">
				<input type="number" v-model="service.price">
			</td>
			<td class="your-amount">
				<input type="number" class="amount" value="">
				<span class="type" style="display: none;">{{service.type}}</span>
			</td>
			<td class="type">{{service.type}}</td>
		</tr>
		<tbody>
			<tr>
				<td colspan="4" class="table-title">
					Монтаж систем кондиционирования
				</td>
			</tr>
		</tbody>
		<tbody>
			<tr v-for="service in table_2">
				<td class="title">{{ service.title }}</td>
				<td class="defaul-price">
					<input type="number" v-model="service.price">
				</td>
				<td class="your-amount">
					<input type="number" class="amount" value="">
					<span class="type" style="display: none;">{{service.type}}</span>
				</td>
				<td class="type">{{service.type}}</td>
			</tr>
		</tbody>
		<tbody>
			<tr>
				<td colspan="4" class="table-title">
					Гипсокартонные работы
				</td>
			</tr>
		</tbody>
		<tbody>
			<tr v-for="service in table_3">
				<td class="title">{{ service.title }}</td>
				<td class="defaul-price">
					<input type="number" v-model="service.price">
				</td>
				<td class="your-amount">
					<input type="number" class="amount" value="">
					<span class="type" style="display: none;">{{service.type}}</span>
				</td>
				<td class="type">{{service.type}}</td>
			</tr>
		</tbody>
		<tbody>
			<tr>
				<td colspan="4" class="table-title">
					Сантехнические работы
				</td>
			</tr>
		</tbody>
		<tbody>
			<tr v-for="service in table_4">
				<td class="title">{{ service.title }}</td>
				<td class="defaul-price">
					<input type="number" v-model="service.price">
				</td>
				<td class="your-amount">
					<input type="number" class="amount" value="">
					<span class="type" style="display: none;">{{service.type}}</span>
				</td>
				<td class="type">{{service.type}}</td>
			</tr>
		</tbody>
		<tbody>
			<tr>
				<td colspan="4" class="table-title">
					Штукатурно-малярные работы
				</td>
			</tr>
		</tbody>
		<tbody>
			<tr v-for="service in table_5">
				<td class="title">{{ service.title }}</td>
				<td class="defaul-price">
					<input type="number" v-model="service.price">
				</td>
				<td class="your-amount">
					<input type="number" class="amount" value="">
					<span class="type" style="display: none;">{{service.type}}</span>
				</td>
				<td class="type">{{service.type}}</td>
			</tr>
		</tbody>
		<tbody>
			<tr>
				<td colspan="4" class="table-title">
					Электромонтажные работы
				</td>
			</tr>
		</tbody>
		<tbody>
			<tr v-for="service in table_6">
				<td class="title">{{ service.title }}</td>
				<td class="defaul-price">
					<input type="number" v-model="service.price">
				</td>
				<td class="your-amount">
					<input type="number" class="amount" value="">
					<span class="type" style="display: none;">{{service.type}}</span>
				</td>
				<td class="type">{{service.type}}</td>
			</tr>
		</tbody>
		<tbody>
			<tr>
				<td colspan="4" class="table-title">
					Демонтажно-подготовительные работы
				</td>
			</tr>
		</tbody>
		<tbody>
			<tr v-for="service in table_7">
				<td class="title">{{ service.title }}</td>
				<td class="defaul-price">
					<input type="number" v-model="service.price">
				</td>
				<td class="your-amount">
					<input type="number" class="amount" value="">
					<span class="type" style="display: none;">{{service.type}}</span>
				</td>
				<td class="type">{{service.type}}</td>
			</tr>
		</tbody>
	</table>
	<table class="print-table" style="display: none;">
		<tr>
			<th>Наименование работы</th>
			<th>Кол-во</th>
			<th>Измер.</th>
			<th>Цена, грн</th>
			<th>Стоимость, грн</th>
		</tr>
		<tr v-for="row in print">
			<td>{{ row.title }}</td>
			<td>{{ row.work }}</td>
			<td>{{ row.type }}</td>
			<td>{{ row.price }}</td>
			<td>{{ row.amount }}</td>
		</tr>
		<tr>
			<td colspan="5" style="text-align: right;"><strong>Всего: {{ total }} грн</strong></td>
		</tr>
	</table>
	<button @click="getPrice();" class="get-price">Посчитать</button>
	<button @click="goBack();" class="go-back" style="display: none;">Назад</button>
	<button @click="printMe();" class="print" style="display: none; float: right;">Распечатать</button>
</div>

<script>
	var app = new Vue({
	 	el: '#app',
	  	data: {
		    services: table,
		    table_2: table_2,
		    table_3: table_3,
		    table_4: table_4,
		    table_5: table_5,
		    table_6: table_6,
		    table_7: table_7,
		    print: [],
		    total: '0'
		},
		methods: {
			getPrice: function() {
				var i = 0,
					defaul_price = 0,
					this_amount = 0,
					all_summ = 0,
					summ = 0,
					print_table = [],
					this_title = '',
					this_type = '';

				$('.amount').each(function(){
					if ($(this).val() != "" && $(this).val() != "0" ) {

						this_title = $(this).closest('tr').find('td.title').text();
						this_type = $(this).closest('tr').find('span.type').text();
						this_amount = parseFloat($(this).val() || 0);
						defaul_price = parseFloat($(this).closest('tr').find('.defaul-price input').val() || 0);
						summ = this_amount * defaul_price;
						all_summ = all_summ + summ;

						print_table.push({
							"title": this_title,
							"type": this_type,
							"work": this_amount,
							"price": defaul_price,
							"amount": this_amount * defaul_price
						})
						i++;
					}
				});

				if ($.isEmptyObject(print_table)) {
					alert('пусто');
					return false;
				}

				this.total = all_summ;
				this.print = print_table;
				$('.work-table').hide();
				$('.get-price').hide();
				$('.print, .go-back, .print-table').show();
			},
			goBack: function() {
				$('.work-table').show();
				$('.get-price').show();
				$('.print, .go-back, .print-table').hide();
			},
			printMe: function (){
				window.print();
			}
		}
	})
	$(function(){
		$('.table-title').click(function(){
			$(this).closest('tbody').next().slideToggle();
		});
	});
</script>
</body>
</html>